<div class="flex" [ngClass]="{'justify-end': message.sender === 'user', 'justify-start': message.sender === 'ai'}">
  <div class="max-w-2xl p-3 rounded-lg shadow-md" [ngClass]="{'bg-blue-500 text-white': message.sender === 'user', 'bg-white text-gray-800': message.sender === 'ai'}">
    <div *ngIf="!message.isLoading">
      <ng-container *ngFor="let segment of segments">
        <ng-container *ngIf="segment.type === 'code'; else textSeg">
          <app-copy-box
            [content]="segment.content"
            [language]="segment.language"
            (contentChange)="segment.content = $event"
          ></app-copy-box>
          <app-canvas *ngIf="isRenderable(segment.language)" [codeToRender]="segment.content"></app-canvas>
        </ng-container>
        <ng-template #textSeg>
          <div class="markdown-content" [innerHTML]="renderMarkdown(segment.content)"></div>
        </ng-template>
      </ng-container>
    </div>
    <div *ngIf="message.isLoading" class="flex items-center space-x-2">
      <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div>
      <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:0.2s]"></div>
      <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:0.4s]"></div>
    </div>
  </div>
</div>
