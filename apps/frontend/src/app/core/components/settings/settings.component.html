<div class="p-8">
  <h2 class="text-2xl font-bold text-gray-800 mb-6">Einstellungen</h2>

  <!-- Benutzer-Info Sektion -->
  @if (authService.isAuthenticated) {
    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
      <div class="flex items-center space-x-4 mb-4">
        <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center">
          @if (userProfile?.avatar) {
            <img [src]="userProfile?.avatar" alt="Avatar" class="w-16 h-16 rounded-full object-cover">
          } @else {
            <span class="text-2xl font-bold text-indigo-600">
              {{ (authService.currentUser?.username?.charAt(0) ?? 'U').toUpperCase() }}
            </span>
          }
        </div>
        <div>
          <h3 class="text-lg font-semibold text-gray-900">
            {{ userProfile?.displayName || authService.currentUser?.username || 'Benutzer' }}
          </h3>
          <p class="text-gray-600">{{ authService.currentUser?.email || '' }}</p>
        </div>
      </div>
      <button
        (click)="logout()"
        class="w-full px-4 py-2 bg-red-600 text-white font-semibold rounded-md hover:bg-red-700"
      >
        Abmelden
      </button>
    </div>

    <!-- Benutzerprofil Formular -->
    <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="space-y-6 bg-white p-6 rounded-lg shadow-md mb-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Benutzerprofil</h3>

      <div>
        <label for="displayName" class="block text-sm font-medium text-gray-700">
          Anzeigename
        </label>
        <input
          id="displayName"
          formControlName="displayName"
          type="text"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
        />
      </div>

      <div>
        <label for="bio" class="block text-sm font-medium text-gray-700">
          Bio
        </label>
        <textarea
          id="bio"
          formControlName="bio"
          rows="3"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
        ></textarea>
      </div>

      <div>
        <label for="timezone" class="block text-sm font-medium text-gray-700">
          Zeitzone
        </label>
        <select
          id="timezone"
          formControlName="timezone"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
        >
          <option value="Europe/Berlin">Europa/Berlin</option>
          <option value="Europe/London">Europa/London</option>
          <option value="America/New_York">Amerika/New York</option>
          <option value="America/Los_Angeles">Amerika/Los Angeles</option>
        </select>
      </div>

      <div class="flex justify-end">
        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-md hover:bg-indigo-700">
          Profil speichern
        </button>
      </div>
    </form>
  } @else {
    <!-- Login-Aufforderung f√ºr nicht angemeldete Benutzer -->
    <div class="bg-blue-50 border border-blue-200 p-6 rounded-lg shadow-md mb-6">
      <div class="flex items-center space-x-3 mb-4">
        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
          <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-blue-900">Jetzt anmelden f√ºr mehr Features!</h3>
          <p class="text-blue-700">Mit einem Konto k√∂nnen Sie Ihre API-Keys und Einstellungen sicher speichern.</p>
        </div>
      </div>
      <div class="flex space-x-3">
        <button
          (click)="navigateToLogin()"
          class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700"
        >
          Anmelden
        </button>
        <button
          (click)="navigateToRegister()"
          class="px-4 py-2 bg-blue-100 text-blue-700 font-semibold rounded-md hover:bg-blue-200 border border-blue-300"
        >
          Registrieren
        </button>
      </div>
    </div>
  }

  <!-- App-Einstellungen Formular -->
  <form [formGroup]="settingsForm" (ngSubmit)="saveSettings()" class="space-y-6 bg-white p-6 rounded-lg shadow-md mb-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">App-Einstellungen</h3>

    <div>
      <label for="theme" class="block text-sm font-medium text-gray-700">
        Design
      </label>
      <select
        id="theme"
        formControlName="theme"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
      >
        <option value="auto">Automatisch</option>
        <option value="light">Hell</option>
        <option value="dark">Dunkel</option>
      </select>
    </div>

    <div>
      <label for="language" class="block text-sm font-medium text-gray-700">
        Sprache
      </label>
      <select
        id="language"
        formControlName="language"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
      >
        <option value="de">Deutsch</option>
        <option value="en">English</option>
        <option value="es">Espa√±ol</option>
      </select>
    </div>

    <div>
      <label for="fontSize" class="block text-sm font-medium text-gray-700">
        Schriftgr√∂√üe: {{ settingsForm.get('fontSize')?.value }}px
      </label>
      <input
        id="fontSize"
        formControlName="fontSize"
        type="range"
        min="12"
        max="20"
        step="1"
        class="mt-1 block w-full"
      />
    </div>

    @if (authService.isAuthenticated) {
      <div class="space-y-3">
        <h4 class="font-medium text-gray-900">Benachrichtigungen</h4>
        <div class="flex items-center">
          <input
            id="emailNotifications"
            type="checkbox"
            formControlName="emailNotifications"
            class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
          />
          <label for="emailNotifications" class="ml-2 block text-sm text-gray-900">
            E-Mail-Benachrichtigungen
          </label>
        </div>

        <div class="flex items-center">
          <input
            id="autoSave"
            type="checkbox"
            formControlName="autoSave"
            class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
          />
          <label for="autoSave" class="ml-2 block text-sm text-gray-900">
            Automatisch speichern
          </label>
        </div>

        <div class="flex items-center">
          <input
            id="chatHistory"
            type="checkbox"
            formControlName="chatHistory"
            class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
          />
          <label for="chatHistory" class="ml-2 block text-sm text-gray-900">
            Chat-Verlauf speichern
          </label>
        </div>
      </div>
    } @else {
      <div class="bg-gray-50 border border-gray-200 p-4 rounded-lg">
        <p class="text-sm text-gray-600 mb-2">
          <strong>üí° Tipp:</strong> Melden Sie sich an, um erweiterte Einstellungen wie Benachrichtigungen zu erhalten.
        </p>
      </div>
    }

    <div class="flex justify-end">
      <button type="submit" class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-md hover:bg-indigo-700">
        Einstellungen speichern
      </button>
    </div>
  </form>

  <!-- API-Schl√ºssel Sektion -->
  <form [formGroup]="apiKeysForm" (ngSubmit)="saveApiKeys()" class="space-y-6 bg-white p-6 rounded-lg shadow-md">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-gray-900">API-Schl√ºssel</h3>
      @if (!authService.isAuthenticated) {
        <span class="bg-orange-100 text-orange-800 text-xs font-medium px-2.5 py-0.5 rounded">
          Tempor√§r gespeichert
        </span>
      }
    </div>

    @if (!authService.isAuthenticated) {
      <div class="bg-orange-50 border border-orange-200 p-4 rounded-lg mb-4">
        <p class="text-sm text-orange-700">
          <strong>‚ö†Ô∏è Hinweis:</strong> Ohne Anmeldung werden Ihre API-Keys nur lokal im Browser gespeichert.
          Mit einem Konto sind sie sicherer und ger√§te√ºbergreifend verf√ºgbar.
        </p>
      </div>
    }

    <div>
      <label for="openai-key" class="block text-sm font-medium text-gray-700">
        OpenAI API Key
      </label>
      <input
        id="openai-key"
        formControlName="openAiApiKey"
        type="password"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
        placeholder="sk-..."
      />
    </div>

    <div>
      <label for="openrouter-key" class="block text-sm font-medium text-gray-700">
        OpenRouter API Key
      </label>
      <input
        id="openrouter-key"
        formControlName="openRouterApiKey"
        type="password"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
        placeholder="sk-or-v1-..."
      />
    </div>

    <div class="flex justify-end">
      <button type="submit" class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-md hover:bg-indigo-700">
        API-Schl√ºssel speichern
      </button>
    </div>
  </form>
</div>
